#!/bin/bash

#SBATCH --partition=gpu
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=1
#SBATCH --gpus=1
#SBATCH --job-name=train_eval
#SBATCH --time=0:05:00
#SBATCH --output=slurm_output_%A_%a.out
#SBATCH --mail-type=BEGIN,END
#SBATCH --mail-user=f.lippert@uva.nl

source activate stdgmrf

cd $HOME/StructuredKalmanSmoother/scripts

which python

# cp -r $HOME/StructuredKalmanSmoother/datasets/ $TMPDIR

#mkdir -p $TMPDIR/$OUTPUTDIR
#mkdir -p $TMPDIR/$OUTPUTDIR/test

nvidia-smi

# don't sync while running on compute nodes
export WANDB_MODE="offline"

srun python test_slurm.py

# sync after completion
wandb sync --sync-all

#cp -r $TMPDIR/$OUTPUTDIR $HOME/StructuredKalmanSmoother/results
#cp -r $WANDB_DIR $HOME/StructuredKalmanSmoother/
