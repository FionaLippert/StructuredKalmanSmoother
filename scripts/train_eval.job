#!/bin/bash

#SBATCH --partition=gpu
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=1
#SBATCH --gpus=1
#SBATCH --job-name=train_eval
#SBATCH --time=2:00:00
#SBATCH --output=slurm_output_%A_%a.out
#SBATCH --mail-type=BEGIN,END
#SBATCH --mail-user=f.lippert@uva.nl

# run this file as "sbatch train_eval.job "var1=val2 var2=val2"

source activate stdgmrf

cd $HOME/StructuredKalmanSmoother/scripts

which python

# cp -r $HOME/StructuredKalmanSmoother/datasets/ $TMPDIR

#OUTDIR=$TMPDIR/results
#mkdir -p $OUTDIR

nvidia-smi

OVERRIDES=$1

echo $OVERRIDES

# don't sync while running on compute nodes
#export WANDB_MODE="offline"
#export WANDB_DIR=$TMPDIR

#srun python test_spdgmrf.py output_dir=$OUTDIR $OVERRIDES
srun python test_spdgmrf.py $OVERRIDES

# sync after completion
#wandb sync --include-offline $WANDB_DIR/wandb/offline-*

#mkdir -p $HOME/StructuredKalmanSmoother/slurm_outputs
#cp -r $OUTDIR $HOME/StructuredKalmanSmoother/slurm_outputs
